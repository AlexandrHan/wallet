SG Wallet це внутрішній веб-застосунок SolarGlass для обліку грошей і руху коштів по холдингу.

Основні модулі:

Гаманець (wallet): кеш-рахунки + банківські рахунки, операції доходів/витрат, статистика.

Holding dashboard: зведення по всіх компаніях/рахунках, фільтри кеш/банк, валюта UAH/USD/EUR, конвертація через курси (якщо є FX).

ERP sync (ERPNext): частина операцій/балансів синхронізується в ERPNext (не завжди, але механізм є).

Reclamations (Рекламації): окремий модуль/сторінки для сервісних звернень клієнтів (зараз у розробці, без Filament).

Архітектурно це Laravel (12.x), без важкого фронтенд-фреймворку: сторінки на Blade + свій JS/CSS у public/.

2) Як влаштований фронтенд

Основний дизайн/тема в public/css/wallet.css (темна “скляна” UI).

Основна логіка гаманця в public/js/wallet.js:

Відкриття рахунків, завантаження операцій, додавання доходів/витрат.

Модалки/шити (sheet) для створення операцій/рахунків.

Відображення статистики, холдинг-картки, FX.

Важливо: wallet.js зав’язаний на певні DOM-елементи (перемикачі, блоки статистики тощо). Якщо робити нову сторінку не “wallet”, краще:

Або підключати wallet.js тільки якщо сторінка має потрібні елементи,

Або (як ми зробили для рекламацій) робити окремий JS (наприклад public/js/reclamations.js) і не тягнути wallet.js.

3) Роутинг і бекенд (API)

В проєкті є API-роути (частина прямо в routes/api.php, інколи у вигляді closure), які використовує wallet.js.

Типові endpoint-и:

GET /api/wallets

GET /api/wallets/{walletId}/entries

POST /api/entries (створення операції)

PUT /api/entries/{id}

DELETE /api/entries/{id}

POST /api/entries/{entry}/receipt (чек/фото до операції)

Нюанс дублювання: при поганому інтернеті користувач може випадково відправити однаковий POST кілька разів. Це треба вирішувати ідемпотентністю (наприклад idempotency_key + unique index), але зараз механізм повністю не доведений до ідеалу.

4) Дані і таблиці (в загальних рисах)

Основні сутності:

users

є роль (owner/accountant тощо)

є actor (наприклад hlushchenko, kolisnyk) для контексту відображення/обмежень.

wallets

тип: cash або bank

валюта: UAH/USD/EUR

власник/owner (логіка прав доступу)

є системні рахунки (is_system) для службових речей

entries

wallet_id, entry_type (income/expense), amount, comment, posting_date

поля для ERP sync (erp_sync_date, erp_synced_at тощо)

можливий hash або ключ для дедуплікації

bank_accounts / bank_transactions_raw / bank_daily_balances

для інтеграцій з банками/імпорту транзакцій і балансів

reclamations (новий модуль)

reported_at, клієнт (прізвище/місто/телефон), loaner (підмінний), серійник, фото, етапи ремонту (дати + ТТН), статуси, нотатки.

5) Рекламації (як планується)

Модуль рекламацій робиться окремими сторінками (не всередині wallet UI), але на тій самій темі wallet.css.
План полів (перший MVP):

Дата створення/звернення

Прізвище, населений пункт, телефон

Підмінний фонд: є/нема, якщо нема то “замовити”

Фото, серійний номер

Етапи:

демонтували (дата) + опис що зробили

де залишили (на складі / відправили на ремонт)

відправили НП на ремонт (ТТН)

сервіс отримав (дата)

відремонтували і відправили (ТТН)

встановили (дата)

повернення підмінного (на склад / постачальнику)

завершили (дата)

Статус + нотатка

Filament пробували і зносили, бо:

конфлікти/несумісності версій під Laravel 12

з’являлась зайва “магія” і багато часу на підтримку.

6) Деплой/оточення

Схема роботи:

Розробка локально → push в GitHub → на сервері pull.

На сервері Laravel лежить у каталозі типу:
/home/.../solarglass.com.ua/wallet

Публічні файли мають віддаватися з public/ (document root має бути саме .../wallet/public).
Якщо document root вказаний на корінь проєкту, то виникають 404 на /css/wallet.css, /js/wallet.js і воно починає працювати тільки через /public/... (це неправильно).

Після pull інколи потрібно:

php artisan migrate --force (на проді обережно)

чистка кешів, якщо юзаються:

php artisan optimize:clear

7) Типові проблеми, про які треба знати підтримці

404 на css/js/manifest/icons/sounds

майже завжди це неправильний document root (має бути public/).

Дублі записів entries при поганій мережі

потрібен захист на бекенді (idempotency) + блокування кнопки на фронті.

Міграції дублюють колонки (actor/role)

в історії міграцій є кілька схожих “add_actor/ensure_actor” і “add_role” -> при migrate:fresh на SQLite ловили duplicate column.

Рішення для підтримки: прибрати/об’єднати дублікати міграцій або зробити перевірку існування колонки (але краще навести лад).

SESSION_DRIVER=database

якщо нема таблиці sessions, логін/сесії падають.

або зробити php artisan session:table + migrate, або перейти на file для локальної розробки.

8) Як програмісту швидко стартувати роботу

Перевірити .env (DB, APP_URL, SESSION_DRIVER).

Перевірити document root (особливо на проді).

Запустити міграції, але уважно до дубль-міграцій.

Переконатися, що wallet.css і wallet.js віддаються без 404.

Для нових сторінок (типу рекламацій) робити окремий JS, не тягнути wallet-логіку.